# Auto Play Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Add per-slide auto play with progress bar that auto-advances during presentation.

**Architecture:** New `autoPlay` / `autoPlayDuration` properties on Slide model, UI controls in the right sidebar Slide tab, and a timer + CSS progress bar in PlaybackController that dispatches the existing `wow3:nextSlide` event when time expires.

**Tech Stack:** Vanilla JS, Web Animations API, CSS transitions, MaterializeCSS

---

### Task 1: Add auto play properties to Slide model

**Files:**
- Modify: `js/models/Slide.js:24-60` (constructor)
- Modify: `js/models/Slide.js:308-321` (toJSON)

**Step 1: Add properties to constructor**

In the constructor, after `this.shellMode = properties.shellMode || 'above';` (line 42), add:

```javascript
// Auto play: automatically advance to next slide after duration
this.autoPlay = properties.autoPlay === true;
this.autoPlayDuration = properties.autoPlayDuration ?? 5;
```

**Step 2: Add properties to toJSON()**

In the `toJSON()` return object, after `shellMode: this.shellMode,` add:

```javascript
autoPlay: this.autoPlay,
autoPlayDuration: this.autoPlayDuration,
```

**Step 3: Commit**

```bash
git add js/models/Slide.js
git commit -m "feat: Add autoPlay and autoPlayDuration properties to Slide model"
```

---

### Task 2: Add auto play UI controls in right sidebar

**Files:**
- Modify: `index.html:130-157` (tab-slide section)

**Step 1: Add HTML for auto play controls**

In `index.html`, inside `<div id="tab-slide" class="tab-content">`, after the shell mode field (`slide-shell-mode-field` div, line 155), add a new property section:

```html
<!-- Auto Play settings -->
<div class="property-section">
  <h6>Auto Play</h6>
  <div class="input-field" style="display: flex; align-items: center; gap: 8px;">
    <label style="position: static; transform: none; pointer-events: auto; cursor: pointer;">
      <input type="checkbox" id="slide-auto-play" />
      <span>Enable</span>
    </label>
  </div>
  <div class="input-field" id="slide-auto-play-duration-field" style="display: none;">
    <input type="number" id="slide-auto-play-duration" min="1" max="300" step="1" value="5">
    <label for="slide-auto-play-duration" class="active">Duration (seconds)</label>
  </div>
</div>
```

**Step 2: Commit**

```bash
git add index.html
git commit -m "feat: Add auto play UI controls to slide settings panel"
```

---

### Task 3: Wire up auto play UI in EditorController

**Files:**
- Modify: `js/controllers/EditorController.js:158-193` (setupEventListeners)
- Modify: `js/controllers/EditorController.js:445-517` (updateUI)

**Step 1: Add event listeners in setupEventListeners()**

After the shell mode dropdown listener (after line 193, before the shell preview toggle), add:

```javascript
// Auto play checkbox
const slideAutoPlay = document.getElementById('slide-auto-play');
if (slideAutoPlay) {
  slideAutoPlay.addEventListener('change', (e) => {
    const activeSlide = this.getActiveSlide();
    activeSlide.autoPlay = e.target.checked;
    this.recordHistory();
    this.updateUI();
  });
}

// Auto play duration input
const slideAutoPlayDuration = document.getElementById('slide-auto-play-duration');
if (slideAutoPlayDuration) {
  slideAutoPlayDuration.addEventListener('change', (e) => {
    const activeSlide = this.getActiveSlide();
    const val = parseInt(e.target.value, 10);
    if (val >= 1 && val <= 300) {
      activeSlide.autoPlayDuration = val;
      this.recordHistory();
    }
  });
}
```

**Step 2: Update the updateUI() method**

After the shell preview toggle button update block (after line 516), add:

```javascript
// Auto play controls
const slideAutoPlay = document.getElementById('slide-auto-play');
const slideAutoPlayDurationField = document.getElementById('slide-auto-play-duration-field');
const slideAutoPlayDuration = document.getElementById('slide-auto-play-duration');
if (slideAutoPlay) {
  slideAutoPlay.checked = activeSlide.autoPlay === true;
}
if (slideAutoPlayDurationField) {
  slideAutoPlayDurationField.style.display = activeSlide.autoPlay ? 'block' : 'none';
}
if (slideAutoPlayDuration) {
  slideAutoPlayDuration.value = activeSlide.autoPlayDuration ?? 5;
}
```

**Step 3: Commit**

```bash
git add js/controllers/EditorController.js
git commit -m "feat: Wire auto play controls in EditorController"
```

---

### Task 4: Add progress bar CSS

**Files:**
- Modify: `css/main.css` (append styles)

**Step 1: Add progress bar styles**

Append to `css/main.css`:

```css
/* Auto play progress bar */
.auto-play-progress {
  position: fixed;
  top: 0;
  left: 0;
  width: 0;
  height: 2px;
  background: #42a5f5;
  z-index: 9999;
  transition-property: width;
  transition-timing-function: linear;
}
```

**Step 2: Commit**

```bash
git add css/main.css
git commit -m "feat: Add auto play progress bar CSS"
```

---

### Task 5: Implement auto play timer and progress bar in PlaybackController

**Files:**
- Modify: `js/controllers/PlaybackController.js:11-27` (constructor)
- Modify: `js/controllers/PlaybackController.js:183-372` (showSlide)
- Modify: `js/controllers/PlaybackController.js:413-430` (advance)
- Modify: `js/controllers/PlaybackController.js:435-442` (nextSlide)
- Modify: `js/controllers/PlaybackController.js:447-453` (previousSlide)
- Modify: `js/controllers/PlaybackController.js:511-559` (stop)

**Step 1: Add auto play state to constructor**

After `this._activeCountdown = null;` (line 26), add:

```javascript
/** @type {number|null} Auto play timer ID */
this._autoPlayTimerId = null;

/** @type {HTMLElement|null} Auto play progress bar element */
this._autoPlayProgressBar = null;
```

**Step 2: Create helper methods for auto play**

Before the `// ==================== COUNTDOWN TIMER ====================` comment (line 561), add:

```javascript
// ==================== AUTO PLAY ====================

/**
 * Start the auto play timer and progress bar for the current slide
 * @param {number} durationSeconds - Duration in seconds
 * @param {HTMLElement} slideContainer - The slide container element
 * @private
 */
_startAutoPlay(durationSeconds, slideContainer) {
  this._clearAutoPlay();

  // Create progress bar
  const bar = document.createElement('div');
  bar.className = 'auto-play-progress';
  bar.style.transitionDuration = `${durationSeconds}s`;
  this.presentationView.appendChild(bar);
  this._autoPlayProgressBar = bar;

  // Force reflow so the transition triggers from width: 0
  bar.offsetWidth;
  bar.style.width = '100%';

  // Set timer to advance slide
  this._autoPlayTimerId = setTimeout(() => {
    this._autoPlayTimerId = null;
    this._clearAutoPlay();
    // Dispatch the same event as the "Next Slide" build out effect
    this.presentationView.dispatchEvent(
      new CustomEvent('wow3:autoPlayNext', { bubbles: false })
    );
  }, durationSeconds * 1000);
}

/**
 * Clear the auto play timer and remove progress bar
 * @private
 */
_clearAutoPlay() {
  if (this._autoPlayTimerId !== null) {
    clearTimeout(this._autoPlayTimerId);
    this._autoPlayTimerId = null;
  }
  if (this._autoPlayProgressBar) {
    this._autoPlayProgressBar.remove();
    this._autoPlayProgressBar = null;
  }
}
```

**Step 3: Start auto play in showSlide()**

At the end of `showSlide()`, after the `appEvents.emit(AppEvents.SLIDE_SELECTED, index);` line (line 371), add:

```javascript
// Start auto play timer if enabled for this slide
if (slide.autoPlay && slide.autoPlayDuration > 0) {
  this._startAutoPlay(slide.autoPlayDuration, slideContainer);
  // Listen for auto play completion
  this.presentationView.addEventListener('wow3:autoPlayNext', () => {
    this.nextSlide();
  }, { once: true });
}
```

**Step 4: Clear auto play at top of showSlide()**

At the beginning of `showSlide()`, after `this._animationManager = null;` (line 191), add:

```javascript
// Clean up any auto play timer from previous slide
this._clearAutoPlay();
```

**Step 5: Clear auto play in stop()**

In the `stop()` method, after `this._animationManager = null;` (line 526), add:

```javascript
// Clean up auto play
this._clearAutoPlay();
```

**Step 6: Commit**

```bash
git add js/controllers/PlaybackController.js
git commit -m "feat: Implement auto play timer and progress bar in PlaybackController"
```
